{"componentChunkName":"component---src-templates-blog-post-js","path":"/android-replace-eventbus-with-livedata/","result":{"data":{"site":{"siteMetadata":{"title":"Trainto.log()"}},"markdownRemark":{"id":"f7f00644-3649-5c59-a4c0-04dbfc89f259","excerpt":"Google announced a new set of architecture libraries. One of the new compoenents is LiveData, which can be used to manage propagating data to the views, while…","html":"<p>Google announced a new set of <a href=\"https://developer.android.com/topic/libraries/architecture/index.html\">architecture libraries</a>. One of the new compoenents is <a href=\"https://developer.android.com/topic/libraries/architecture/livedata.html\">LiveData</a>, which can be used to manage propagating data to the views, while respecting the view’s lifecycles. It means you don’t have to care about view’s lifecycles anymore.</p>\n<p>Using this LiveData, an event bus can be implemented without any 3rd party libraries like <a href=\"http://square.github.io/otto/\">Otto</a>. It also can be achieved using Rx, but with Rx, it can easily lead to memory leaks unless subscriptions managed carefully. With LiveData, we don’t have to worry about memory leaks or view’s lifecycles.</p>\n<p>Let’s start with implementation. (Kotlin will be used)</p>\n<p>To use LiveData in your application, dependencies should be applied to your gradle configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\"><span class=\"token comment\">// This includes LiveDdata and ViewModel</span>\n<span class=\"token comment\">// If you want to add just LiveData, then use</span>\n<span class=\"token comment\">// \"android.arch.lifecycle:livedata:x.x.x\"</span>\nimplementation <span class=\"token string gstring\">\"android.arch.lifecycle:extensions:1.1.0\"</span></code></pre></div>\n<p>Ok, everything’s set to start.</p>\n<p>We need a class holds livedata(event) first.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">object</span> EventProvider <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> liveDataEvent <span class=\"token operator\">=</span> MutableLiveData<span class=\"token operator\">&lt;</span>Event<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>liveDataEvent<span class=\"token punctuation\">.</span><span class=\"token function\">postValue</span><span class=\"token punctuation\">(</span><span class=\"token function\">Event</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">getEventLiveData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MutableLiveData<span class=\"token operator\">&lt;</span>Event<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> liveDataEvent\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token keyword\">class</span> <span class=\"token function\">Event</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> value<span class=\"token operator\">:</span>Any<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> isConsumed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n        <span class=\"token keyword\">fun</span> <span class=\"token function\">setConsumed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            isConsumed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">fun</span> <span class=\"token function\">isConsumed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Boolean <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> isConsumed\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This class is singleton and holds MutalbeLiveData<Event>. The Event class’s value field has Any type so that any type of data can be sent through this EvnetProvider. And Event can be submmited through post function. Also note that the Event class has isConsumed field. This is due to the behaviour of LiveData which it sends out when new observer is registered. This is totally fine if it is for propagating values, but here LiveData is used for Event Bus, so we don’t want to receive events every time activities created and registered.</p>\n<p>Ok, now we prepared event bus. Now let’s subscribe this event bus from the view(activity).</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> BaseActivity <span class=\"token operator\">:</span> <span class=\"token function\">AppCompatActivity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token operator\">:</span> Bundle<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span>\n\n        EventProvider<span class=\"token punctuation\">.</span><span class=\"token function\">getEventLiveData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> Observer <span class=\"token punctuation\">{</span>\n            it<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">let</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">isConsumed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">handleEventBus</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                it<span class=\"token punctuation\">.</span><span class=\"token function\">setConsumed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">handleEventBus</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">is</span> String <span class=\"token operator\">-></span> Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Event\"</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I mentioned that with LiveData, we don’t have to care about view’s lifecycles. To take this advantage, activity should extend android.support.vy.app.AppCompatActivity.(For fragment, it should extends android.support.v4.app.Fragment) Because these support libraries are already integrated with LifecycleOwners.</p>\n<p>This BaseActivity subscribes the event bus through call observe(LifecyclerOwner, Observer) of the LiveData inside of EventProvider on its onCreate() lifecycle. When event occurred, Observer checks if this event consumed before, if it’s not, then call handleEventBus function.</p>\n<p>Now you can create activities extends this BaseActivity, and override the handleEventBus to make the activity has its own behaviour to the specific event.</p>","frontmatter":{"title":"Android - Replace EventBus with LiveData","date":"February 12, 2018","description":null}}},"pageContext":{"slug":"/android-replace-eventbus-with-livedata/","previous":{"fields":{"slug":"/kotlin-magic-with-let-apply-run-and-with/"},"frontmatter":{"title":"Kotlin - Kotlin's magic with let, apply, run and with"}},"next":{"fields":{"slug":"/android-implementing-zip-function-using-livedata/"},"frontmatter":{"title":"Android - Implementing Zip function using LiveData"}}}}}